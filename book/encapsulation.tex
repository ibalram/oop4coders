%=====================================================================
\ifx\wholebook\relax\else
	\documentclass{KodeBook}
	\input{calls}
	\begin{document}
\fi
%=====================================================================

\chapter{Encapsulation}

\begin{introduction}
	Encapsulation is one important concept of OOP. 
	It is the mechanism of restricting direct access to some members of a class.
	It helps managing complexity when debugging source code. 
	If a field is accessed everywhere in your source code, this makes it difficult to find errors related to this field. 
	Also, if a field of a class (A) is used by a class (B) then we changed it (either its name or how it gets assigned), we have to change all the code where it appears in (B).
	In this chapter, we will show different visibility modes and how they are implemented in each language.
\end{introduction}

\section{Public members}

Public visibility mode is used to access a member of a class from everywhere. 
Public methods of a class provide an interface that allows them to be called so the object can afford some behavior. 
As for fields, public visibility mode is not preferable since it breaks encapsulation, and it has limited uses:
\begin{itemize}
	\item Constant fields can be exposed to the outside classes.%Joshua Bloch writes in Effective Java
	\item Classes which represent just data, and unlikely to be changed in the future.
\end{itemize}

\subsection{C++}

Public members are defined inside the class header using the modifier \keyword{public}. 
Every member coming after that modifier is considered as public.
If you use \keyword{struct} instead of \keyword{class}, all members are public by default.

\lstinputlisting[language=C++, linerange={6-7,12-15,25-25}, style=codeStyle]{../codes/cpp/encapsulation/person.h}

These members can be accessed anywhere

\lstinputlisting[language=C++, linerange={10-12, 14-14, 17-18,27-28}, style=codeStyle]{../codes/cpp/encapsulation/app.cpp}

An important remark: when you compile multiple files using g++, you have to include all cpp files
\begin{lstlisting}[style=shellStyle]
$ g++ app.cpp person.cpp student.cpp frnd.h
\end{lstlisting}

If you include a header twice or more, you may have an error telling you that you defined the class more than once. 
To correct this, you have to use \nameword{\#include guard}.

\lstinputlisting[language=C++, linerange={1-3,6-7,25-26}, style=codeStyle]{../codes/cpp/encapsulation/person.h}

\subsection{Java}

Every public member in Java must preceded by the keyword \keyword{public}. 

\lstinputlisting[language=Java, linerange={1-5,12-12,18-20,27-29}, style=codeStyle]{../codes/java/src/encapsulation/core/Person.java}

These members can be accessed anywhere
\lstinputlisting[language=Java, linerange={1-8,10-10,14-14,16-18}, style=codeStyle]{../codes/java/src/encapsulation/main/App.java}

\subsection{Javascript} 

All fields with the keyword \keyword{this} are public. 
All  methods defined using the same keyword inside the constructor or using the prototype are public.

%\lstinputlisting[linerange={1-1,5-5}, style=codeStyle]{../codes/javascript/person2.js}
%
%\lstinputlisting[linerange={1-1,15-15}, style=codeStyle]{../codes/javascript/person.js}


\subsection{Lua}

%\lstinputlisting[language={[5.2]Lua}, linerange={1-2}, style=codeStyle]{../codes/lua/person.lua}

\subsection{Perl}

%\lstinputlisting[language=Perl, linerange={4-4}, style=codeStyle]{../codes/perl/person.pl}

\subsection{PHP}

The default visibility mode in PHP is public.
A function defined without a visibility modifier or a variable defined using \keyword{var} are public by default. 
It is a good practice to prefix class members with a visibility modifier, since the inverse is used just to keep forward compatibility with versions before 5.1.3.

\lstinputlisting[language=PHP, linerange={2-5,11-11,15-15,17-17,24-25}, style=codeStyle]{../codes/php/encapsulation/person.php}

The member with public visibility mode can be accessed anywhere.

\lstinputlisting[language=PHP, linerange={3-3,6-6,8-9,12-12}, style=codeStyle]{../codes/php/encapsulation/app.php}

\subsection{Python}

All class members are public by default; it is the only visibility mode in Python. 

\lstinputlisting[language=Python, linerange={4-4, 8-8, 12-12,15-15,19-19}, style=codeStyle]{../codes/python/encapsulation/person.py}

The members can be accessed anywhere
\lstinputlisting[language=Python, linerange={4-7, 9-9, 13-13}, style=codeStyle]{../codes/python/encapsulation/app.py}

\subsection{Ruby}

By default methods are public except for \keyword{initialize} method and the global methods defined under the object class which are private always. 
If desired, you can use the keyword \keyword{public} in a line and all methods defined after it are public. 
Fields are not public unless they are constants. 
To access them like public in other languages, you have to define an accessor methods (the fields have to be properties).
In Ruby, public getters and setters are called \nameword{attribute readers} and \nameword{attribute writers}.

\lstinputlisting[language=Ruby, linerange={1-1,5-5,9-9,13-13,15-15,17-17,22-22,34-35,39-39,46-46}, style=codeStyle]{../codes/ruby/encapsulation/person.rb}

The field can be accessed for read and write. 
Actually, the field is accessed via a getter and a setter which are public by default (because they are methods).

\lstinputlisting[language=Ruby, linerange={6-9,14-14,20-20}, style=codeStyle]{../codes/ruby/encapsulation/app.rb}


\section{Protected members}

\subsection{C++}

Protected members are defined inside the class header using the modifier \keyword{protected}. 
Every member coming after that modifier is considered as protected.

\lstinputlisting[language=C++, linerange={6-7,18-19,25-25}, style=codeStyle]{../codes/cpp/encapsulation/person.h}

These members can be accessed only from the class itself or its subclasses

\lstinputlisting[language=C++, linerange={1-5,8-8}, style=codeStyle]{../codes/cpp/encapsulation/student.cpp}

They cannot be accessed elsewhere

\lstinputlisting[language=C++, linerange={10-12,16-16,27-28}, style=codeStyle]{../codes/cpp/encapsulation/app.cpp}

\subsection{Java}

Protected members are prefixed each by the keyword \keyword{protected}. 
A protected member is visible inside the class and its subclass, and also to other classes in the same package. 
There is no difference between visibility modes of fields and those of methods; they are the same.

\lstinputlisting[language=Java, linerange={1-3,7-7,34-34}, style=codeStyle]{../codes/java/src/encapsulation/core/Person.java}

The field can be accessed from a subclass (which is not necessarily in the same package)

\lstinputlisting[language=Java, linerange={1-7,11-13}, style=codeStyle]{../codes/java/src/encapsulation/core/Student.java}

It can be accessed from classes of the same package

\lstinputlisting[language=Java, linerange={1-7,10-12}, style=codeStyle]{../codes/java/src/encapsulation/core/App2.java}

And cannot be accessed from a class outside the package and not inheriting from their containing class.

\lstinputlisting[language=Java, linerange={1-8,13-13,16-18}, style=codeStyle]{../codes/java/src/encapsulation/main/App.java}

It is also important to point out that protected members can be accessed from another object of the same class 

\lstinputlisting[language=Java, linerange={3-3,7-7,29-29,31-34}, style=codeStyle]{../codes/java/src/encapsulation/core/Person.java}


\subsection{Javascript} 

%\lstinputlisting[linerange={1-1,5-5}, style=codeStyle]{../codes/javascript/person2.js}

%\lstinputlisting[linerange={1-1,15-15}, style=codeStyle]{../codes/javascript/person.js}


\subsection{Lua}

%\lstinputlisting[language={[5.2]Lua}, linerange={1-2}, style=codeStyle]{../codes/lua/person.lua}

\subsection{Perl}

%\lstinputlisting[language=Perl, linerange={4-4}, style=codeStyle]{../codes/perl/person.pl}

\subsection{PHP}

%\lstinputlisting[language=PHP, linerange={2-2,27-27}, style=codeStyle]{../codes/php/person.php}

\subsection{Python}

%\lstinputlisting[language=Python, linerange={4-4}, style=codeStyle]{../codes/python/person.py}

\subsection{Ruby}

All fields are protected by default and there is no other visibility mode. 
Methods are public by default, but can be defined as protected using either \keyword{private} or \keyword{protected}. 

\lstinputlisting[language=Ruby, linerange={2-2,7-8,10-13,16-16,25-33,47-47}, style=codeStyle]{../codes/ruby/encapsulation/person.rb}

The methods defined using \keyword{private} or \keyword{protected} can both be accessed from sub-classes.

\lstinputlisting[language=Ruby, linerange={3-4,13-19}, style=codeStyle]{../codes/ruby/encapsulation/student.rb}

The difference is that those with \keyword{private} cannot be accessed from another object even if it is of the same class. 
Those with \keyword{protected} can be accessed from the an object of the same class.

\lstinputlisting[language=Ruby, linerange={2-2,42-47}, style=codeStyle]{../codes/ruby/encapsulation/person.rb}

The fields and the protected methods cannot be accessed outside the class and its sub-classes

\lstinputlisting[language=Ruby, linerange={6-6,10-11,17-18}, style=codeStyle]{../codes/ruby/encapsulation/app.rb}

\section{Private members}

\subsection{C++}

Private members are defined inside the class header using the modifier \keyword{private}. 
Every member coming after that modifier is considered as private.

\lstinputlisting[language=C++, linerange={6-7,21-25}, style=codeStyle]{../codes/cpp/encapsulation/person.h}

These members can be accessed only from the class itself and not its subclasses

\lstinputlisting[language=C++, linerange={3-4,7-8}, style=codeStyle]{../codes/cpp/encapsulation/student.cpp}

Also, an object can access another object's members if they are of the same class whatever their visibility is.

\lstinputlisting[language=C++, linerange={23-27}, style=codeStyle]{../codes/cpp/encapsulation/person.cpp}

\subsection{Java}

Private members are prefixed each by the keyword \keyword{private}. 
A private member (field or method) is visible only inside the class. 

\lstinputlisting[language=Java, linerange={1-3,7-7,34-34}, style=codeStyle]{../codes/java/src/encapsulation/core/Person.java}

It cannot be accessed from a subclass

\lstinputlisting[language=Java, linerange={3-3,5-6,10-13}, style=codeStyle]{../codes/java/src/encapsulation/core/Student.java}

And sure cannot be accessed from another class

\lstinputlisting[language=Java, linerange={5-8,12-12,16-18}, style=codeStyle]{../codes/java/src/encapsulation/main/App.java}

It is also important to point out that private members can be accessed from another object of the same class 

\lstinputlisting[language=Java, linerange={3-3,7-7,29-30,32-34}, style=codeStyle]{../codes/java/src/encapsulation/core/Person.java}

\subsection{Javascript} 

%\lstinputlisting[linerange={1-1,5-5}, style=codeStyle]{../codes/javascript/person2.js}
%
%\lstinputlisting[linerange={1-1,15-15}, style=codeStyle]{../codes/javascript/person.js}


\subsection{Lua}

%\lstinputlisting[language={[5.2]Lua}, linerange={1-2}, style=codeStyle]{../codes/lua/person.lua}

\subsection{Perl}

%\lstinputlisting[language=Perl, linerange={4-4}, style=codeStyle]{../codes/perl/person.pl}

\subsection{PHP}

%\lstinputlisting[language=PHP, linerange={2-2,27-27}, style=codeStyle]{../codes/php/person.php}

\subsection{Python}

%\lstinputlisting[language=Python, linerange={4-4}, style=codeStyle]{../codes/python/person.py}

\subsection{Ruby}

There are no private members in Ruby, which are visible just inside their class. 
Even if you try to limit access of a field to read-only, it can be accessed from sub-classes. 
This is because the field itself is protected and \keyword{attr\_reader} creates a getter for this field. 

\lstinputlisting[language=Ruby, linerange={2-2,7-8,10-11,16-16,47-47}, style=codeStyle]{../codes/ruby/encapsulation/person.rb}

\lstinputlisting[language=Ruby, linerange={3-3,5-6,9-9,19-19}, style=codeStyle]{../codes/ruby/encapsulation/student.rb}

\section{Other visibility modes}

\subsection{C++}

public, protected and private are the only visibility modes applied to class members. 
But, a class can specify an external function of another class to be able to access its members whatever their visibility mode is. 
This is known as \nameword{friend function} and \nameword{friend class} respectively. 
They can be specified using the keyword \keyword{friend} before each. 

\lstinputlisting[language=C++, linerange={6-11,18-19,21-22,25-25}, style=codeStyle]{../codes/cpp/encapsulation/person.h}

The new class can access all fields 

\lstinputlisting[language=C++, linerange={7-14}, style=codeStyle]{../codes/cpp/encapsulation/frnd.h}

The same thing for the function

\lstinputlisting[language=C++, linerange={5-8}, style=codeStyle]{../codes/cpp/encapsulation/app.cpp}

There are some notes about friendship:
\begin{itemize}
	\item It is not transitive: a friend of a friend is not a friend.
	\item It can not be inherited: subclasses of a friend class are not friends.
\end{itemize}

\subsection{Java}

Another visibility mode is \nameword{package visibility} where the members of a class are only accessed from classes of the same package. 
If you don't prefix the member by any of the three visibility modes, it means it is a package member.

\lstinputlisting[language=Java, linerange={1-3,6-6,34-34}, style=codeStyle]{../codes/java/src/encapsulation/core/Person.java}

It can be accessed from classes of the same package

\lstinputlisting[language=Java, linerange={1-6,8-8,10-12}, style=codeStyle]{../codes/java/src/encapsulation/core/App2.java}

But cannot be accessed outside the package

\lstinputlisting[language=Java, linerange={1-8,11-11,16-18}, style=codeStyle]{../codes/java/src/encapsulation/main/App.java}

%\subsection{Javascript} 
%
%\lstinputlisting[linerange={1-1,5-5}, style=codeStyle]{../codes/javascript/person2.js}
%
%\lstinputlisting[linerange={1-1,15-15}, style=codeStyle]{../codes/javascript/person.js}
%
%
%\subsection{Lua}
%
%\lstinputlisting[language={[5.2]Lua}, linerange={1-2}, style=codeStyle]{../codes/lua/person.lua}
%
%\subsection{Perl}
%
%\lstinputlisting[language=Perl, linerange={4-4}, style=codeStyle]{../codes/perl/person.pl}
%
%\subsection{PHP}
%
%\lstinputlisting[language=PHP, linerange={2-2,27-27}, style=codeStyle]{../codes/php/person.php}
%
%\subsection{Python}
%
%\lstinputlisting[language=Python, linerange={4-4}, style=codeStyle]{../codes/python/person.py}
%
%\subsection{Ruby}
%
%\lstinputlisting[language=Ruby, linerange={3-3,19-19}, style=codeStyle]{../codes/ruby/person.rb}


%=====================================================================
\ifx\wholebook\relax\else
% \cleardoublepage
% \bibliographystyle{../use/ESIbib}
% \bibliography{../bib/RATstat}
	\end{document}
\fi
%=====================================================================